<% content_for(:head) do %>
	<%= stylesheet_link_tag '../javascripts/themes/basic/grid.css', :cache => true %>
	<%= stylesheet_link_tag '../javascripts/themes/jqModal.css', :cache => true %>
	<%= stylesheet_link_tag 'grid_custom.css', :cache => true %>
	<%= javascript_include_tag 'jquery.jqGrid.js', :cache => true %>
	<%= javascript_include_tag 'js/jqModal.js', :cache => true %>
	<%= javascript_include_tag 'js/jqDnR.js', :cache => true %>
	<%= javascript_include_tag 'ui/effects.core.js', :cache => true %>
	<%= javascript_include_tag 'ui/effects.highlight.js', :cache => true %>
	<%= javascript_include_tag 'ui/effects.blind.js', :cache => true %>
<% end %>

<% content_for(:search) do %>
	<table id="searchGrid" class="scroll"></table>
	<div id="searchPager" class="scroll"></div>
	
	<script type="text/javascript">
	var hideCageCol = false;
	if ("<%=h @rectype%>" == "WORKAUTH") {
		hideCageCol = true;
	}
	var lastSel;
	jQuery(document).ready(function(){
		var searchGrid = jQuery('#searchGrid').jqGrid({
			url: '/brecords/grid_records',
			datatype: 'json',
			mtype: 'GET',
			colNames: ['Id', 'Name', 'Cage', 'Rev', 'Ver', 'Description'],
			colModel :[
				{name:'id',       index:'id', hidden:true},
				{name:'name',     index:'brecname', width:80},
				{name:'cage',     index:'brecname', width:50,  align:'right', hidden: hideCageCol},
				{name:'brecalt',  index:'brecalt',  width:30,  align:'right'},
				{name:'brecver',  index:'brecver',  width:27,  align:'right'},
				{name:'bdesc',    index:'bdesc',    width:300, sortable:false} ],
			rowNum: 10,
			rowList: [10,20,30,50,100],
			sortname: 'brecname',
			sortorder: 'asc',
			viewrecords: true,
			imgpath: '/javascripts/themes/basic/images',
			caption: 'Find result table -- <%=h @rectype%>',
			height: '100%',
			width: 925,
			pager: 'searchPager',
			ondblClickRow: function(id) {
				if (id && id!==lastSel) {
					jQuery('.HeaderButton',$('#searchGrid')[0].grid.cDiv).trigger('click');
					//var gtf = jQuery('#searchGrid').GridToForm(id, "#record");
					lastSel=id;
					jQuery.ajax({
						type: "POST",
						url: ("<%= url_for(:action => 'load_record_base', :controller => 'brecords') %>?id="+id),
						dataType: "script"
					});
				}
			},
			postData: {rectype: '<%=h @rectype%>'}
		})
		.navGrid('#searchPager', {refresh: true, edit: false, add: false, del: false, search: true})
		.navButtonAdd('#searchPager',
			{ caption:"Load",
				onClickButton:function() {
					var gsr = jQuery('#searchGrid').getGridParam('selrow');
					if (gsr) {
						var gtf = jQuery("#searchGrid").GridToForm(gsr,"#record");
					} else {
						alert("Please select Row");
					}
				}
			}
		)
	});
	</script>
<% end %>

<% content_for(:content) do %>
	<%=render :partial => 'tabs'%>
<% end %>